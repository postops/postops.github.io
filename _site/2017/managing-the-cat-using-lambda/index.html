<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Managing the cat using lambda</title>
  <meta name="description" content="cat /dev/random > blog">
  <meta name="author" content="Jay Wallace">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Managing the cat using lambda">
  <meta name="twitter:description" content="revisiting my first post in lambda">
  <meta name="twitter:image" content="http://www.postops.co/images/posts/lambda-post/lambda-cat.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Managing the cat using lambda">
  <meta property="og:description" content="revisiting my first post in lambda">
  <meta property="og:image" content="http://www.postops.co/images/posts/lambda-post/lambda-cat.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="///2017/managing-the-cat-using-lambda/">
  <link rel="alternate" type="application/rss+xml" title="postops" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of postops">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">postops</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">cat /dev/random > blog</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to postops blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/mootpt" title="@mootpt on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            
            <!-- Medium -->
            <li class="navigation__item">
              <a href="https://medium.com/@postops" title="postops on Medium" target="_blank">
                <i class="icon icon-social-medium"></i>
                <span class="label">Medium</span>
              </a>
            </li>
          

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/cantc" title="cantc on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/mootpt" title="mootpt on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="https://keybase.io/nullpt" title="nullpt on Keybase" target="_blank">
                  <i class="icon icon-key"></i>
                  <span class="label">Keybase</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="21 Jan 2017" class="post-meta__date date">21 Jan 2017</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#lambda">lambda</a> <a href="/tags/#serverless">serverless</a> <a href="/tags/#fun">fun</a> <a href="/tags/#botvac">botvac</a> <a href="/tags/#neato">neato</a> </span>
    </div>
    <h1 class="post-title">Managing the cat using lambda</h1>
  </header>

  <section class="post">
    <p>Okay, so it’s been some time since I posted my original article about controlling your neato botvac by creating Packer image and eventually deploying it using Terraform. Since my original post, I decided to throw out the whole Packer thing. It doesn’t really make all that much sense to manage our own AMI for our Botvac. Instead, we can go the serverless route, while still taking advantage of Terraform. With a bit of Node.js, I was able to streamline the Botvac control process, while also utilizing the AWS API Gateway. In this post I am going to go through the Lambda function I created, how I deployed it and the AWS API Gateway using Terraform, and how I used the Maker service in IFTTT to start the Botvac in a particular area once a motion sensor is triggered. So let’s get started.</p>

<p>The Lambda Function:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">botvac</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'node-botvac'</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">botvac</span><span class="p">.</span><span class="nx">Client</span><span class="p">();</span>
  <span class="c1">//authorize</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">authorize</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">//get your robots</span>
      <span class="nx">client</span><span class="p">.</span><span class="nx">getRobots</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">robots</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
              <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">robots</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
              <span class="c1">//do something</span>
              <span class="nx">robots</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">startSpotCleaning</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="s1">'100'</span><span class="p">,</span><span class="s1">'100'</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
              <span class="p">});</span>
          <span class="p">}</span>
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></figure>


    <a href="https://github.com/postops/postops.github.io/tree/master/_posts/2017-01-21-managing-the-cat-using-lambda.markdown" target="_blank">See a mistake? Open a PR.</a>
  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'postops'; // required: replace example with your forum shortname
        var disqus_config = function () {
          this.page.url = 'http://postops.co/2017/managing-the-cat-using-lambda/';
          this.page.identifier = '/2017/managing-the-cat-using-lambda';
          this.page.title = 'Managing the cat using lambda';
        };
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2017 Jay Wallace. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


    </div>
  </body>
</html>
